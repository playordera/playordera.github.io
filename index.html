<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ORDERA</title>
  <link href="https://fonts.googleapis.com/css2?family=Staatliches&display=swap" rel="stylesheet">
  <style>
    :root{
      --green:#20a844;
      --cat1:#6956e8; --cat2:#8c77ff; --catSolid:#e7e9ff;
      --maxw:760px; --radius:16px;
      --fontLogo:96px; --fontTile:22px;
    }
    body{margin:0;font-family:"Staatliches",sans-serif;background:var(--catSolid);color:#111;text-align:center}
    /* Loader */
    #loader{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#111;z-index:9999}
    .logo-squares{position:relative;width:160px;height:160px}
    .square{position:absolute;width:100px;height:100px;border-radius:16px;background:linear-gradient(135deg,#6956e8,#8c77ff,#ff3b30,#20a844);animation:breathe 1.6s infinite,hueflow 5s linear infinite}
    .square.top{top:30px;left:30px}
    @keyframes breathe{0%,100%{transform:scale(1)}50%{transform:scale(1.07)}}
    @keyframes hueflow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    /* Header */
    .app-header{background:#111;color:#fff;padding:10px}
    .wordmark{font-size:var(--fontLogo);color:var(--cat1)}
    .cat-pill{background:var(--cat1);padding:6px 14px;border-radius:20px;color:#fff}
    /* Events */
    .events{list-style:none;padding:0;max-width:var(--maxw);margin:auto}
    .tile{background:#fff;border-radius:12px;padding:12px;margin:8px 0;display:flex;justify-content:space-between;align-items:center;cursor:grab;transition:.1s}
    .tile.locked{opacity:.7;pointer-events:none}
    .tile.dragging{opacity:.95;transform:scale(1.02);box-shadow:0 18px 40px rgba(0,0,0,.25)}
    .rank{width:36px;height:36px;display:grid;place-items:center;background:#ccc;border-radius:8px;margin-right:8px}
    .rank.correct{background:var(--green);color:#fff}
    .handle{font-size:20px;opacity:.7}
    /* Buttons */
    button{margin:5px;padding:10px 16px;font-size:18px;border:none;border-radius:10px;cursor:pointer}
    .primary{background:var(--green);color:#fff}
    .catBtn{background:var(--cat1);color:#fff}
    /* Feedback */
    .feedbackRow{display:flex;gap:6px;margin:6px auto;justify-content:center}
    .square{width:28px;height:28px;background:#ddd}
    .square.correct{background:var(--green)}
    /* Endgame */
    .endgame{display:none;margin-top:20px}
    .endgame.show{display:block}
    .sharePreview{background:#eef3ff;padding:10px;border-radius:8px;text-align:left}
    /* ‚ùå overlay */
    #xOverlay{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:120px;font-weight:900;color:red;opacity:0;z-index:9999}
    #xOverlay.show{animation:shake .5s,fadeOut .6s forwards}
    @keyframes shake{0%,100%{transform:translate(-50%,-50%) rotate(0)}20%{transform:translate(-52%,-50%) rotate(-10deg)}40%{transform:translate(-48%,-50%) rotate(10deg)}}
    @keyframes fadeOut{to{opacity:0}}
    /* Pinned submit */
    #submitPinned{position:fixed;bottom:-120px;left:0;right:0;background:var(--green);color:#fff;padding:14px;font-size:20px;font-weight:900;transition:.25s}
    #submitPinned.show{bottom:0;opacity:1}
    @media(min-width:640px){#submitPinned{display:none}}
  </style>
</head>
<body>
  <div id="loader">
    <div class="logo-squares">
      <div class="square"></div>
      <div class="square top"></div>
    </div>
  </div>
  <header class="app-header">
    <div class="wordmark">ORDERA</div>
    <span class="cat-pill"><span id="catText">Category</span></span>
  </header>
  <main>
    <h2 id="titleBanner">‚Äî</h2>
    <div class="attempts">Attempts: <span id="attemptsUsed">0</span>/6</div>
    <div class="buttons">
      <button id="shuffleBtn" class="catBtn">Shuffle</button>
      <button id="resetBtn" class="catBtn">Reset</button>
      <button id="submitBtn" class="primary">Submit</button>
    </div>
    <ul id="eventsList" class="events"></ul>
    <p class="hint">Tap to swap or drag from right edge (‚â°). Locked greens don‚Äôt move.</p>
    <section id="feedbackSection"></section>
    <section id="endgame" class="endgame">
      <h2 id="endTitle">‚Äî</h2>
      <p id="endSubtitle"></p>
      <button id="shareBtn" class="primary" style="display:none">Share Result</button>
      <pre id="sharePreview" class="sharePreview" style="display:none"></pre>
    </section>
  </main>
  <button id="submitPinned">Submit</button>
  <div id="xOverlay">‚ùå</div>
  <footer><small>¬© ORDERAgames</small></footer>
  <script>
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwFwFuI5Uhh-6yjFPqVm2Ub_IHBq05HWjVBTUq13gOv9Q6cMp3jUVtt7rc8o3GCTP-qRw/exec";
    const els = {loader:document.getElementById("loader"),catText:document.getElementById("catText"),titleBanner:document.getElementById("titleBanner"),used:document.getElementById("attemptsUsed"),list:document.getElementById("eventsList"),fb:document.getElementById("feedbackSection"),end:document.getElementById("endgame"),endTitle:document.getElementById("endTitle"),endSub:document.getElementById("endSubtitle"),shareBtn:document.getElementById("shareBtn"),sharePrev:document.getElementById("sharePreview"),submit:document.getElementById("submitBtn"),shuffle:document.getElementById("shuffleBtn"),reset:document.getElementById("resetBtn"),submitPinned:document.getElementById("submitPinned"),xOverlay:document.getElementById("xOverlay")};
    const state={puzzle:null,order:[],lockedMap:{},attempts:[],used:0,selected:null,solved:false};
    async function fetchData(){const res=await fetch(APPS_SCRIPT_URL+"?min=8&max=12");return await res.json();}
    function todayPuzzle(list){const idx=(new Date()).getDate()-1;return list[idx%list.length];}
    function makeTile(itemIndex,pos){const li=document.createElement("li");li.className="tile";li.dataset.pos=pos;if(state.lockedMap[pos]===itemIndex)li.classList.add("locked");const rank=document.createElement("div");rank.className="rank";rank.textContent=pos+1;if(state.lockedMap[pos]===itemIndex)rank.classList.add("correct");const txt=document.createElement("div");txt.textContent=state.puzzle.items[itemIndex].t;const handle=document.createElement("div");handle.className="handle";handle.textContent="‚â°";li.append(rank,txt,handle);li.onclick=()=>onTap(pos);enableDrag(li);return li;}
    function renderList(){els.list.innerHTML="";state.order.forEach((i,pos)=>els.list.appendChild(makeTile(i,pos)));}
    function renderFeedback(){els.fb.innerHTML="";state.attempts.forEach(row=>{const div=document.createElement("div");div.className="feedbackRow";row.forEach(c=>{const sq=document.createElement("div");sq.className="square"+(c?" correct":"");div.appendChild(sq)});els.fb.appendChild(div)});}
    function onTap(pos){if(state.selected==null){state.selected=pos;els.list.children[pos].classList.add("selected");return;}const src=state.selected,dst=pos;[state.order[src],state.order[dst]]=[state.order[dst],state.order[src]];els.list.children[src].classList.remove("selected");state.selected=null;renderList();}
    function enableDrag(tile){tile.addEventListener("pointerdown",e=>{if(tile.classList.contains("locked"))return;if(e.clientX<tile.getBoundingClientRect().right-tile.offsetWidth*0.25&&!e.target.classList.contains("handle"))return;const parent=els.list;const rect=tile.getBoundingClientRect();let grabY=e.clientY-rect.top;const ph=document.createElement("li");ph.className="tile";ph.style.height=rect.height+"px";parent.insertBefore(ph,tile.nextSibling);tile.classList.add("dragging");tile.style.width=rect.width+"px";tile.style.position="fixed";tile.style.left=rect.left+"px";tile.style.top=(e.clientY-grabY)+"px";tile.style.zIndex=1000;document.body.appendChild(tile);const move=ev=>{tile.style.top=(ev.clientY-grabY)+"px";const kids=[...parent.children].filter(c=>c!==ph);for(let k of kids){const r=k.getBoundingClientRect();if(ev.clientY<r.top+r.height/2){parent.insertBefore(ph,k);return;}}parent.appendChild(ph);};const up=()=>{document.removeEventListener("pointermove",move);document.removeEventListener("pointerup",up);parent.insertBefore(tile,ph);parent.removeChild(ph);tile.classList.remove("dragging");tile.removeAttribute("style");state.order=[...els.list.children].map(li=>state.order[li.dataset.pos]);renderList();};document.addEventListener("pointermove",move);document.addEventListener("pointerup",up);});}
    function flashX(){els.xOverlay.classList.remove("show");void els.xOverlay.offsetWidth;els.xOverlay.classList.add("show");}
    function submit(){const correct=state.puzzle.correct,curr=state.order.map(i=>state.puzzle.items[i]);let row=[],newCorrect=false;curr.forEach((it,i)=>{const ok=it.t===correct[i].t;row.push(ok);if(ok&&!state.lockedMap[i]){state.lockedMap[i]=state.order[i];newCorrect=true;}});state.attempts.push(row);state.used++;els.used.textContent=state.used;renderList();renderFeedback();if(!newCorrect)flashX();if(row.every(Boolean)){state.solved=true;end();}else if(state.used>=6)end();}
    function end(){els.end.classList.add("show");els.endTitle.textContent=state.solved?"You solved it!":"Out of attempts.";els.endSub.textContent=`ORDERA ‚Äî ${state.solved?state.used:"X"}/6`;const share=`ORDERA ‚Äî ${state.solved?state.used:"X"}/6\n`+state.attempts.map(r=>r.map(c=>c?"üü©":"‚¨ú").join("")).join("\n");els.sharePrev.textContent=share;els.sharePrev.style.display="block";els.shareBtn.style.display="inline-block";}
    async function boot(){const puzzles=await fetchData();const p=todayPuzzle(puzzles);state.puzzle={title:p.title,category:p.category,items:p.events.map(e=>({t:e.event,y:e.year})),correct:p.events.slice().sort((a,b)=>a.year-b.year)};state.order=state.puzzle.items.map((_,i)=>i).sort(()=>Math.random()-0.5);els.catText.textContent=p.category;els.titleBanner.textContent=p.title;renderList();els.loader.style.display="none";els.submit.onclick=submit;els.submitPinned.onclick=submit;els.shuffle.onclick=()=>{state.order.sort(()=>Math.random()-0.5);renderList()};els.reset.onclick=()=>{state.lockedMap={};state.attempts=[];state.used=0;renderList();renderFeedback()};}
    boot();
  </script>
</body>
</html>