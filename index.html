<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,viewport-fit=cover,user-scalable=no" />
  <title>Altera</title>
  <link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet" />

  <style>
  :root {
    --correct:#10b981;
    --wrong:#ef4444;
    --tile1:#5b6cff; --tile2:#2ec6ff; --tile3:#ff477e; --tile4:#ffb020;
  }
  body {
    margin:0; font-family:'Bungee',sans-serif; color:#fff;
    background:#142049; display:flex; flex-direction:column;
    min-height:100vh; text-align:center;
  }

  /* Header always visible */
  header { 
    padding:18px 0 12px; 
    flex-shrink:0;
  }
  .logo {
    font-size:46px; font-weight:900; color:#ff477e;
    text-shadow:0 0 6px rgba(0,0,0,0.4);
  }
  .sub { font-size:16px; margin:6px 0; color:#ffffff; opacity:0.95; }
  #progress { font-size:14px; margin:4px 0 12px; color:#ffffff; }

  /* Game Area */
  main { 
    flex:1; 
    display:flex; 
    justify-content:center; 
    padding:10px 0 20px; 
    box-sizing:border-box;
  }
  #options {
    width:100%; max-width:460px;
    display:grid; grid-template-columns:repeat(2,1fr); gap:14px;
    padding:0 20px; box-sizing:border-box;
    align-content:start;
  }
  .option {
    display:flex; align-items:center; justify-content:center;
    aspect-ratio:1/1; border-radius:12px;
    font-size:20px; cursor:pointer; user-select:none;
    color:#fff; font-weight:bold; transition:.2s transform;
  }
  .option:active { transform:scale(.95); }
  .option:nth-child(1){background:var(--tile1);}
  .option:nth-child(2){background:var(--tile2);}
  .option:nth-child(3){background:var(--tile3);}
  .option:nth-child(4){background:var(--tile4);}
  .correct { background:var(--correct)!important; }
  .wrong { background:var(--wrong)!important; }

  /* Overlay & End screen */
  #overlay, #endScreen {
    position:fixed; inset:0; display:none;
    flex-direction:column; align-items:center; justify-content:center;
    background:rgba(0,0,0,.9); z-index:50; padding:20px;
  }
  #overlay.show, #endScreen.show { display:flex; }
  #overlay h1 { margin:0 0 8px; font-size:32px; }
  #overlay p { font-size:16px; max-width:340px; }

  #continueBtn {
    margin-top:14px; padding:12px 24px;
    border:none; border-radius:8px; background:var(--correct);
    color:#fff; font-size:16px; cursor:pointer;
  }

  #endIcons { font-size:60px; margin-bottom:12px; }
  #endText { margin:0; font-size:28px; }
  #shareBtn {
    display:none; margin-top:16px;
    padding:12px 24px; font-size:18px;
    border:none; border-radius:8px; background:#5b6cff;
    color:#fff; cursor:pointer;
  }

  footer { font-size:12px; padding:8px 0; opacity:.85; line-height:1.3; flex-shrink:0; }
  </style>
</head>
<body>
  <header>
    <div class="logo">ALTERA</div>
    <div class="sub">FIND THE ODD ONE OUT</div>
    <div id="progress"></div>
  </header>

  <main>
    <div id="options"></div>
  </main>

  <!-- Feedback -->
  <div id="overlay">
    <h1 id="result"></h1>
    <p id="explanation"></p>
    <button id="continueBtn">Continue</button>
  </div>

  <!-- End screen -->
  <div id="endScreen">
    <div id="endIcons"></div>
    <h1 id="endText"></h1>
    <button id="shareBtn">Share</button>
  </div>

  <footer id="footerInfo"></footer>

  <script>
  const DATA_URL="puzzles.json";
  let puzzles, todaySet;
  let level=0;
  let results=[];
  let streak={current:0,best:0,lastDate:null};

  const options=document.getElementById("options"),
        progressEl=document.getElementById("progress"),
        overlay=document.getElementById("overlay"),
        resultEl=document.getElementById("result"),
        explanationEl=document.getElementById("explanation"),
        continueBtn=document.getElementById("continueBtn"),
        endScreen=document.getElementById("endScreen"),
        endIcons=document.getElementById("endIcons"),
        endText=document.getElementById("endText"),
        shareBtn=document.getElementById("shareBtn"),
        footerInfo=document.getElementById("footerInfo");

  function ymd(){const d=new Date();return d.getFullYear()+String(d.getMonth()+1).padStart(2,"0")+String(d.getDate()).padStart(2,"0");}
  function ymdDash(){const d=new Date();return d.toISOString().split("T")[0];}
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
  function saveStreak(){localStorage.setItem("altera_streak",JSON.stringify(streak));}
  function loadStreak(){try{const s=localStorage.getItem("altera_streak");if(s)streak=JSON.parse(s);}catch{}}

  async function loadPuzzles(){
    const res=await fetch(DATA_URL+"?v="+ymd(),{cache:"no-store"});
    const data=await res.json();
    puzzles=data.days;
    const idx=parseInt(ymd())%puzzles.length;
    todaySet=puzzles[idx];
  }

  function renderLevel(){
    progressEl.textContent=`Puzzle ${level+1}/3`;
    options.innerHTML="";
    const pool= level===0 ? todaySet.easy : (level===1?todaySet.medium:todaySet.hard);
    const items=shuffle([...pool.words]);
    items.forEach((w)=>{
      const t=document.createElement("div");
      t.className="option";
      t.textContent=w;
      t.onclick=()=>checkChoice(w,pool,t);
      options.appendChild(t);
    });
  }

  function checkChoice(choice,pool,tile){
    [...options.children].forEach(c=>c.onclick=null);
    if(choice===pool.odd){
      tile.classList.add("correct");
      results.push("âœ“");
      showFeedback(true,pool.explanation);
    }else{
      tile.classList.add("wrong");
      results.push("âœ—");
      showFeedback(false,pool.explanation);
    }
  }

  function showFeedback(ok,ex){
    resultEl.textContent=ok?"âœ“ Correct":"âœ— Wrong";
    resultEl.style.color=ok?"var(--correct)":"var(--wrong)";
    explanationEl.textContent=ex;
    continueBtn.style.background=ok?"var(--correct)":"var(--wrong)";
    overlay.classList.add("show");
  }

  continueBtn.onclick=()=>{
    overlay.classList.remove("show");
    if(results[results.length-1]==="âœ—"){finish(false);}
    else if(++level<3){renderLevel();}
    else{finish(true);}
  };

  function finish(win){
    options.innerHTML="";
    endScreen.classList.add("show");
    endIcons.innerHTML=results.map(r=> r==="âœ“" 
      ? `<span style="color:var(--correct)">âœ“</span>` 
      : `<span style="color:var(--wrong)">âœ—</span>`).join(" ");
    if(win){
      endText.textContent="You Win!";
      if(streak.lastDate!==ymd()){
        streak.current++;
        streak.best=Math.max(streak.best,streak.current);
        streak.lastDate=ymd();
      }
    }else{
      endText.textContent="Game Over";
      streak.current=0; streak.lastDate=ymd();
    }
    saveStreak();updateFooter();
    shareBtn.style.display="inline-block";
  }

  shareBtn.onclick=()=>{
    let msg="";
    if(results[0]==="âœ—") msg="I flopped hard on Altera (0/3)";
    else if(results[1]==="âœ—") msg="I only got 1 right on Altera (1/3)";
    else if(results[2]==="âœ—") msg="So close! 2/3 on Altera";
    else msg="Flawless victory! 3/3 on Altera";
    msg+=`\nðŸ”¥ Streak: ${streak.current}`;
    if(navigator.share){navigator.share({title:"Altera",text:msg});}
    else{navigator.clipboard.writeText(msg).then(()=>alert("Copied!"));}
  };

  function updateFooter(){
    footerInfo.innerHTML=`Seed: ${ymd()}<br>Date: ${ymdDash()}<br>ðŸ”¥ Streak: ${streak.current} (Best: ${streak.best})`;
  }

  (async function(){
    loadStreak(); updateFooter();
    await loadPuzzles(); renderLevel();
  })();
  </script>
</body>
</html>