<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Altera â€” Find the Odd One Out</title>
<link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">
<style>
:root{
  --fg:#fff;
  --radius:14px;
  --c1:#5b6cff; --c2:#2ec6ff; --c3:#ff477e; --c4:#ffb020;
  --correct:#10b981; --wrong:#ef4444;
  --bg1:#142049; --bg2:#20306d; --bg3:#244688; --bg4:#267ca6;
}
html,body{height:100%;margin:0;font-family:'Bungee',sans-serif;color:var(--fg);}
body{
  display:grid;grid-template-rows:auto 1fr auto;overflow:hidden;
  background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4));
  background-size:220% 220%;animation:bgSoft 20s ease-in-out infinite;
}
@keyframes bgSoft{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

header{text-align:center;padding:6px 0 0}
.logo{
  margin:0;font-size:50px;
  background:linear-gradient(90deg,var(--c1),var(--c2),var(--c3),var(--c4));
  -webkit-background-clip:text;background-clip:text;
  -webkit-text-fill-color:transparent;
  background-size:400% auto;
  animation:logoFade 12s linear infinite;
}
@keyframes logoFade{
  0%{background-position:0% 50%}
  100%{background-position:100% 50%}
}
.sub{margin:0;font-size:16px;opacity:.95}
#progress{font-size:14px;margin:4px 0 8px;opacity:.95}

#game{display:flex;align-items:center;justify-content:center;min-height:0}
#options{
  width:100%;max-width:460px;padding:0 20px;
  display:grid;grid-template-columns:repeat(2,1fr);gap:16px;
}

.option{
  position:relative;display:flex;align-items:center;justify-content:center;
  color:#fff;border-radius:var(--radius);aspect-ratio:1/1;
  font-size:22px;cursor:pointer;user-select:none;overflow:hidden;
  box-shadow:0 6px 18px rgba(0,0,0,.25);transition:transform .2s ease;
}
.option:active{transform:scale(.95)}
.option span{display:block}
.option:nth-child(1){background:var(--c1)}
.option:nth-child(2){background:var(--c2)}
.option:nth-child(3){background:var(--c3)}
.option:nth-child(4){background:var(--c4)}

/* Level 2 glow (intense) */
.lvl2{animation:pulseGlow 2s ease-in-out infinite;}
@keyframes pulseGlow{
  0%{box-shadow:0 0 8px rgba(255,255,255,0.6);}
  50%{box-shadow:0 0 60px rgba(255,255,255,1);}
  100%{box-shadow:0 0 8px rgba(255,255,255,0.6);}
}

/* Level 3 shimmer + wiggle (intense) */
.lvl3{
  animation:wiggle 5s ease-in-out infinite;
}
.lvl3::after{
  content:"";position:absolute;inset:0;border-radius:inherit;
  background:linear-gradient(120deg,transparent 35%,rgba(255,255,255,.9) 50%,transparent 65%);
  transform:translateX(-150%);
  animation:sheen 2.5s ease-in-out infinite;
  animation-delay:var(--delay,0s);
}
@keyframes sheen{0%{transform:translateX(-150%)}50%{transform:translateX(150%)}100%{transform:translateX(150%)}}
@keyframes wiggle{0%,100%{transform:rotate(0deg);}25%{transform:rotate(3deg);}75%{transform:rotate(-3deg);}}

/* Feedback overlay */
#feedbackOverlay{
  position:fixed;inset:0;display:none;z-index:200;
  align-items:center;justify-content:center;flex-direction:column;
  background:rgba(0,0,0,.9);text-align:center;padding:20px;
}
#feedbackOverlay .symbol{margin-bottom:18px}
#feedbackOverlay .text{font-size:34px;margin-bottom:12px}
#feedbackOverlay .explanation{font-size:18px;max-width:360px;margin-bottom:18px;color:#fff}
#continueBtn{padding:14px 28px;border:none;border-radius:var(--radius);background:var(--wrong);color:#fff;font-size:18px;cursor:pointer}
#feedbackOverlay.correct #continueBtn{background:var(--correct)}

/* Filled check / X */
.checkmark {
  width: 90px; height: 90px;
  fill: var(--correct);
  stroke: var(--correct);
  stroke-width: 4;
  animation: scaleIn .4s ease forwards;
}
.crossmark {
  font-size:90px;
  color: var(--wrong);
  animation: scaleIn .4s ease forwards;
}
@keyframes scaleIn{from{transform:scale(0.5);opacity:0;}to{transform:scale(1);opacity:1;}}

/* End screen */
#endScreen{
  position:fixed;inset:0;display:none;z-index:150;
  align-items:center;justify-content:center;flex-direction:column;gap:18px;
  text-align:center;padding:20px;
}
#summary{font-size:26px}
.bigChecks{font-size:64px;margin-bottom:8px}
#shareBtn{
  display:none;
  background:var(--c1);color:#fff;font-size:20px;
  padding:16px 32px;border-radius:var(--radius);border:none;cursor:pointer;
  box-shadow:0 10px 24px rgba(0,0,0,.25);
}

footer{text-align:center;font-size:12px;opacity:.95;padding:6px 8px 10px;line-height:1.35em}
</style>
</head>
<body>
  <header>
    <h1 class="logo">ALTERA</h1>
    <div class="sub">Find the odd one out</div>
    <div id="progress"></div>
  </header>

  <main id="game">
    <div id="options"></div>
  </main>

  <!-- End screen -->
  <div id="endScreen" aria-live="polite">
    <div class="bigChecks" id="finalChecks"></div>
    <div id="summary"></div>
    <button id="shareBtn">Share</button>
  </div>

  <!-- Feedback overlay -->
  <div id="feedbackOverlay">
    <div class="symbol"></div>
    <div class="text"></div>
    <div class="explanation"></div>
    <button id="continueBtn">Continue</button>
  </div>

  <footer id="footerInfo"></footer>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script>
const DATA_URL="puzzles.json";
const DIFFICULTIES=["easy","medium","hard"];
const tz="America/Edmonton";

let puzzles=[], todaySet=[], currentIndex=0, results=[];
let streakData={ current:0, best:0, lastDate:null };
let pendingCallback=null;

const optEl=document.getElementById("options");
const endScreen=document.getElementById("endScreen");
const summaryEl=document.getElementById("summary");
const finalChecks=document.getElementById("finalChecks");
const shareBtn=document.getElementById("shareBtn");
const overlay=document.getElementById("feedbackOverlay");
const overlaySymbol=overlay.querySelector(".symbol");
const overlayText=overlay.querySelector(".text");
const overlayExp=overlay.querySelector(".explanation");
const continueBtn=document.getElementById("continueBtn");
const footerInfo=document.getElementById("footerInfo");
const progressEl=document.getElementById("progress");

function loadStreak(){const s=localStorage.getItem("altera_streak");if(s){streakData=JSON.parse(s);}}
function saveStreak(){localStorage.setItem("altera_streak",JSON.stringify(streakData));}
function toYMD(date,tz){const z=new Date(date.toLocaleString('en-US',{timeZone:tz}));return `${z.getFullYear()}${String(z.getMonth()+1).padStart(2,'0')}${String(z.getDate()).padStart(2,'0')}`;}
function mulberry32(a){return function(){let t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296;}}
function seededPick(rng,arr){return arr[Math.floor(rng()*arr.length)]}
function shuffleArray(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}

loadStreak(); loadData();
async function loadData(){const res=await fetch(DATA_URL);const data=await res.json();puzzles=data.themes;setupDaily();}

function setupDaily(){
  const seed=toYMD(new Date(),tz);const rng=mulberry32(Number(seed));
  todaySet=DIFFICULTIES.map(d=>seededPick(rng,puzzles.filter(p=>p.difficulty===d)));
  updateFooter(seed);startPuzzle(0);
}
function updateFooter(seed){
  const today=new Date().toLocaleDateString('en-CA',{timeZone:tz});
  footerInfo.innerHTML=`Seed: ${seed}<br>Date: ${today}<br>ðŸ”¥ Streak: ${streakData.current} (Best: ${streakData.best})`;
}

function startPuzzle(i){
  currentIndex=i;progressEl.textContent=`Puzzle ${i+1}/3`;
  const p=todaySet[i];const shuffled=shuffleArray([...p.items]);
  optEl.innerHTML="";
  shuffled.forEach((item)=>{
    const tile=document.createElement("div");
    tile.className="option lvl"+(i+1);
    if(i===2){tile.style.setProperty("--delay",`${Math.random()*2}s`);}
    tile.innerHTML=`<span>${item}</span>`;
    tile.onclick=()=>choose(tile,item,p);
    optEl.appendChild(tile);
  });
}

function choose(tile,choice,puzzle){
  if(navigator.vibrate) navigator.vibrate(50);
  Array.from(optEl.children).forEach(c=>c.onclick=null);
  const correct=(choice===puzzle.answer);
  if(correct){
    results.push("âœ”");
    showOverlay(true,puzzle.explanation,()=>{ 
      confettiBurst(currentIndex); 
      if(currentIndex<2){startPuzzle(currentIndex+1);} 
      else{finishGame(true);} 
    });
  }else{
    results.push("âœ–");
    showOverlay(false,puzzle.explanation,()=>finishGame(false));
  }
}

function confettiBurst(level){
  let count=80;
  if(level===0) count=50;
  if(level===1) count=100;
  if(level===2) count=150;
  confetti({particleCount:count,spread:70,origin:{y:.6}});
  // streak update immediately on final win
  if(level===2){
    const todaySeed=toYMD(new Date(),tz);
    if(streakData.lastDate!==todaySeed){
      streakData.current=(streakData.current+1);
      streakData.best=Math.max(streakData.best,streakData.current);
      streakData.lastDate=todaySeed;saveStreak();
    }
    updateFooter(todaySeed);
  }
}

function showOverlay(correct,explanation,cb){
  overlay.style.display="flex";
  overlaySymbol.innerHTML= correct ? 
    `<svg class="checkmark" viewBox="0 0 52 52"><path d="M14 27l7 7 16-16"/></svg>` 
    : `<div class="crossmark">âœ–</div>`;
  overlayText.textContent=correct?"Correct":"Game Over";
  overlayExp.textContent=explanation;
  pendingCallback=cb;
}
continueBtn.onclick=()=>{overlay.style.display="none";if(pendingCallback){pendingCallback();pendingCallback=null;}};

function finishGame(won){
  optEl.innerHTML="";
  endScreen.style.display="flex";
  finalChecks.textContent=results.join(" ");
  summaryEl.textContent=`${won?"Cleared all!":"Game over"}`;
  shareBtn.style.display="inline-flex";
}

shareBtn.onclick=()=>{
  const d=new Date().toLocaleDateString('en-CA',{timeZone:tz});
  let msg="";
  if(results[0]==="âœ–"){msg="Altera humbled me today ðŸ’€ (0/3)";}
  else if(results[1]==="âœ–"){msg="I only cracked 1 puzzle on Altera ðŸ«  (1/3)";}
  else if(results[2]==="âœ–"){msg="So close! 2/3 puzzles solved on Altera ðŸ˜¤";}
  else{msg="Flawless! 3/3 puzzles solved on Altera ðŸŽ‰";}
  const text=`Altera ${d}\n${msg}\nðŸ”¥ Streak: ${streakData.current}`;
  if(navigator.share){navigator.share({title:"Altera",text});}
  else{navigator.clipboard.writeText(text).then(()=>alert("Results copied!")); }
};
</script>
</body>
</html>