<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Odd One Out — Daily</title>
<style>
:root {
  --bg: #fdfdfd;
  --fg: #222;
  --muted: #666;
  --radius: 16px;
  --tile-size: 90px;
}
body {
  margin:0; font-family: 'Arial Rounded MT Bold', system-ui, sans-serif;
  background: var(--bg); color: var(--fg);
  display:flex; flex-direction:column; align-items:center; min-height:100vh;
}
header {
  background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #1dd1a1);
  color:white; width:100%; text-align:center; padding:20px;
  font-size:28px; font-weight:900; letter-spacing:1px;
}
#game {
  flex:1; display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:20px;
  width:100%; max-width:600px; padding:20px;
}
#question { font-size:20px; font-weight:600; margin-bottom:10px; }
#options {
  display:grid; grid-template-columns: repeat(2, 1fr);
  gap:16px; width:100%;
}
.option {
  display:flex; align-items:center; justify-content:center;
  border-radius: var(--radius); padding:20px; font-size:20px;
  font-weight:600; cursor:pointer; color:#fff; text-align:center;
  user-select:none; height: var(--tile-size);
  transition: transform 0.1s ease;
}
.option:active { transform:scale(0.95); }
.option:nth-child(1){ background:#ff6b6b; }
.option:nth-child(2){ background:#48dbfb; }
.option:nth-child(3){ background:#1dd1a1; }
.option:nth-child(4){ background:#feca57; }
#message {
  font-size:18px; color: var(--muted); min-height:24px; text-align:center;
}
.hidden { display:none; }
#feedbackOverlay {
  position:fixed; inset:0; background:rgba(0,0,0,0.85);
  display:flex; align-items:center; justify-content:center; flex-direction:column;
  color:white; font-size:32px; font-weight:900; text-align:center;
  z-index:100; display:none;
}
#feedbackOverlay.correct { background:rgba(0,200,100,0.9); }
#feedbackOverlay.wrong { background:rgba(220,50,50,0.9); }
#feedbackOverlay .symbol { font-size:80px; margin-bottom:20px; }
#endScreen {
  text-align:center; margin-top:20px;
}
button {
  padding:14px 20px; font-size:16px; border-radius:var(--radius);
  border:none; cursor:pointer; margin-top:12px;
}
button.primary {
  background:linear-gradient(90deg,#ff6b6b,#feca57); color:white; font-weight:700;
}
</style>
</head>
<body>
<header>ODD ONE OUT</header>
<div id="game">
  <div id="question"></div>
  <div id="options"></div>
  <div id="message"></div>
  <button id="nextBtn" class="hidden primary">Next</button>
  <div id="endScreen" class="hidden">
    <div id="summary"></div>
    <button class="primary" id="shareBtn">Share</button>
  </div>
</div>

<div id="feedbackOverlay">
  <div class="symbol"></div>
  <div class="text"></div>
  <div id="explanation" style="margin-top:20px;font-size:18px;max-width:80%;"></div>
</div>

<script>
const DATA_URL = "puzzles.json"; // JSON file with puzzles
const DIFFICULTIES = ["easy","medium","hard"];
const tz = "America/Edmonton";

function toYMD(date, timeZone){
  const z = new Date(date.toLocaleString('en-US',{timeZone}));
  return `${z.getFullYear()}${String(z.getMonth()+1).padStart(2,'0')}${String(z.getDate()).padStart(2,'0')}`;
}
function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15,t|1); t^=t+Math.imul(t^t>>>7,t|61); return((t^t>>>14)>>>0)/4294967296; } }
function seededPick(rng, arr){ return arr[Math.floor(rng()*arr.length)]; }

let puzzles=[]; let todaySet=[]; let currentIndex=0; let results=[];

const qEl=document.getElementById("question");
const optEl=document.getElementById("options");
const msgEl=document.getElementById("message");
const nextBtn=document.getElementById("nextBtn");
const endScreen=document.getElementById("endScreen");
const summaryEl=document.getElementById("summary");
const shareBtn=document.getElementById("shareBtn");
const overlay=document.getElementById("feedbackOverlay");
const overlaySymbol=overlay.querySelector(".symbol");
const overlayText=overlay.querySelector(".text");
const overlayExp=document.getElementById("explanation");

async function loadData(){
  const res=await fetch(DATA_URL);
  const data=await res.json();
  puzzles=data.themes;
  setupDaily();
}
function setupDaily(){
  const seed=toYMD(new Date(),tz);
  const rng=mulberry32(Number(seed));
  todaySet=DIFFICULTIES.map(diff=>{
    const pool=puzzles.filter(p=>p.difficulty===diff);
    return seededPick(rng,pool);
  });
  startPuzzle(0);
}
function startPuzzle(i){
  currentIndex=i;
  const p=todaySet[i];
  qEl.textContent=`Puzzle ${i+1} (${p.difficulty})`;
  optEl.innerHTML="";
  p.items.forEach(item=>{
    const div=document.createElement("div");
    div.className="option";
    div.textContent=item;
    div.onclick=()=>choose(item,p);
    optEl.appendChild(div);
  });
  msgEl.textContent="";
  nextBtn.classList.add("hidden");
}
function showOverlay(correct, explanation){
  overlay.style.display="flex";
  overlay.className=correct?"correct":"wrong";
  overlaySymbol.textContent=correct?"✅":"❌";
  overlayText.textContent=correct?"Correct!":"Game Over";
  overlayExp.textContent=explanation;
  setTimeout(()=>{overlay.style.display="none";},2000);
}
function choose(choice,puzzle){
  Array.from(optEl.children).forEach(c=>c.onclick=null);
  if(choice===puzzle.answer){
    results.push("✅");
    showOverlay(true,puzzle.explanation);
    if(currentIndex<2){
      setTimeout(()=>{nextBtn.classList.remove("hidden");},2000);
    }else{
      setTimeout(()=>finishGame(true),2000);
    }
  }else{
    results.push("❌");
    showOverlay(false,puzzle.explanation);
    setTimeout(()=>finishGame(false),2000);
  }
}
function finishGame(won){
  nextBtn.classList.add("hidden");
  endScreen.classList.remove("hidden");
  summaryEl.textContent=`Result: ${results.join(" ")} (${won?"You cleared all puzzles!":"Game over"})`;
}
nextBtn.onclick=()=>{startPuzzle(currentIndex+1);};
shareBtn.onclick=()=>{
  const d=new Date().toLocaleDateString('en-CA',{timeZone:tz});
  const text=`Odd One Out ${d}\n${results.join(" ")}\nPlay: (your game URL)`;
  if(navigator.share){navigator.share({title:"Odd One Out",text});}
  else{navigator.clipboard.writeText(text).then(()=>alert("Results copied!"));}
};
loadData();
</script>
</body>
</html>