<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Altera â€” Find the Odd One Out</title>

<!-- Never cache the HTML -->
<meta http-equiv="Cache-Control" content="no-store" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet" />
<style>
:root{
  --fg:#fff;
  --radius:14px;
  --c1:#5b6cff; --c2:#2ec6ff; --c3:#ff477e; --c4:#ffb020;
  --correct:#10b981; --wrong:#ef4444;
  --bg1:#142049; --bg2:#20306d; --bg3:#244688; --bg4:#267ca6;
}
html,body{height:100%;margin:0;font-family:'Bungee',sans-serif;color:var(--fg);}
body{
  display:grid;grid-template-rows:auto 1fr auto;overflow:hidden;
  background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4));
  background-size:220% 220%;animation:bgSoft 20s ease-in-out infinite;
}
@keyframes bgSoft{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

header{text-align:center;padding:10px 0 0}
.logo{
  margin:0;font-size:50px;
  /* Seamless cycle: start and end on the same color band */
  background:linear-gradient(90deg,
    var(--c1) 0%,
    var(--c2) 25%,
    var(--c3) 50%,
    var(--c4) 75%,
    var(--c1) 100%
  );
  -webkit-background-clip:text;background-clip:text;
  -webkit-text-fill-color:transparent;
  background-size:400% 100%;
  animation:logoScroll 16s linear infinite;
}
@keyframes logoScroll{
  0%{background-position:0% 0}
  100%{background-position:100% 0}
}
.sub{margin:0;font-size:16px;opacity:.95}
#progress{font-size:14px;margin:6px 0 10px;opacity:.95}

#game{display:flex;align-items:center;justify-content:center;min-height:0}
#options{
  width:100%;max-width:460px;padding:0 20px;
  display:grid;grid-template-columns:repeat(2,1fr);gap:16px;
}

.option{
  position:relative;display:flex;align-items:center;justify-content:center;
  color:#fff;border-radius:var(--radius);aspect-ratio:1/1;
  font-size:22px;cursor:pointer;user-select:none;overflow:hidden;
  box-shadow:0 6px 18px rgba(0,0,0,.25);transition:transform .2s ease;
}
.option:active{transform:scale(.95)}
.option:nth-child(1){background:#5b6cff}
.option:nth-child(2){background:#2ec6ff}
.option:nth-child(3){background:#ff477e}
.option:nth-child(4){background:#ffb020}

/* Level 3: subtle, independent glow (no rotation) */
.lvl3{animation:softGlow 4s ease-in-out infinite;}
@keyframes softGlow{
  0%,100%{box-shadow:0 0 6px rgba(255,255,255,.28);}
  50%{box-shadow:0 0 22px rgba(255,255,255,.70);}
}

/* Feedback overlay */
#feedbackOverlay{
  position:fixed;inset:0;display:none;z-index:200;
  align-items:center;justify-content:center;flex-direction:column;
  background:rgba(0,0,0,.9);text-align:center;padding:20px;
}
#feedbackOverlay .label{font-size:34px;margin:12px 0 10px}
#feedbackOverlay .ex{font-size:18px;max-width:360px;margin-bottom:16px;color:#fff}
#continueBtn{padding:14px 28px;border:none;border-radius:var(--radius);background:var(--correct);color:#fff;font-size:18px;cursor:pointer}

/* Filled tokens (inline SVG uses explicit fills for reliability) */
.token{width:96px;height:96px;display:inline-block}
.token.sm{width:56px;height:56px}

/* End screen */
#endScreen{
  position:fixed;inset:0;display:none;z-index:150;
  align-items:center;justify-content:center;flex-direction:column;gap:14px;
  text-align:center;padding:20px;
}
#finalChecks{display:flex;gap:12px;align-items:center;justify-content:center}
#summary{font-size:24px}
#shareBtn{
  display:none;background:#5b6cff;color:#fff;font-size:20px;
  padding:14px 28px;border-radius:var(--radius);border:none;cursor:pointer;
  box-shadow:0 10px 24px rgba(0,0,0,.25);
}

/* Footer */
footer{text-align:center;font-size:12px;opacity:.95;padding:6px 8px 10px;line-height:1.35em}
</style>
</head>
<body>
  <header>
    <h1 class="logo">ALTERA</h1>
    <div class="sub">FIND THE ODD ONE OUT</div>
    <div id="progress"></div>
  </header>

  <main id="game">
    <div id="options"></div>
  </main>

  <!-- End screen -->
  <div id="endScreen" aria-live="polite">
    <div id="finalChecks"></div>
    <div id="summary"></div>
    <button id="shareBtn">Share</button>
  </div>

  <!-- Feedback overlay -->
  <div id="feedbackOverlay">
    <div id="iconSlot"></div>
    <div class="label" id="iconLabel"></div>
    <div class="ex" id="iconEx"></div>
    <button id="continueBtn">Continue</button>
  </div>

  <footer id="footerInfo"></footer>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script>
/* ===== Daily data & cache-busting ===== */
const DATA_URL = "puzzles.json";
const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || "UTC";

/* ===== State ===== */
let todaySet = [];     // normalized array of 3 puzzles: {items:[...4], answer:'', explanation:''}
let currentIndex = 0;
let results = [];
let streak = { current: 0, best: 0, lastDate: null };

/* ===== DOM ===== */
const optEl = document.getElementById("options");
const progressEl = document.getElementById("progress");
const endScreen = document.getElementById("endScreen");
const finalChecks = document.getElementById("finalChecks");
const summaryEl = document.getElementById("summary");
const shareBtn = document.getElementById("shareBtn");
const footerInfo = document.getElementById("footerInfo");
const overlay = document.getElementById("feedbackOverlay");
const iconSlot = document.getElementById("iconSlot");
const iconLabel = document.getElementById("iconLabel");
const iconEx = document.getElementById("iconEx");
const continueBtn = document.getElementById("continueBtn");

/* ===== Utils ===== */
function ymd(d=new Date()){ const z=new Date(d.toLocaleString('en-US',{timeZone:tz})); return `${z.getFullYear()}${String(z.getMonth()+1).padStart(2,'0')}${String(z.getDate()).padStart(2,'0')}`;}
function ymdDash(d=new Date()){ const z=new Date(d.toLocaleString('en-US',{timeZone:tz})); return `${z.getFullYear()}-${String(z.getMonth()+1).padStart(2,'0')}-${String(z.getDate()).padStart(2,'0')}`;}
function mulberry32(a){return function(){let t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296;}}
function seededPick(rng,arr){return arr[Math.floor(rng()*arr.length)]}
function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}
function saveStreak(){localStorage.setItem("altera_streak", JSON.stringify(streak));}
function loadStreak(){try{const s=localStorage.getItem("altera_streak");if(s) streak=JSON.parse(s);}catch{}}

/* Tokens as inline SVG (explicit fills to avoid CSS conflicts) */
function svgCheck(size=96){return `
<svg class="token" width="${size}" height="${size}" viewBox="0 0 64 64" aria-hidden="true">
  <circle cx="32" cy="32" r="30" fill="#10b981"></circle>
  <path d="M20 33l7 7 18-18" stroke="#fff" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" fill="none"></path>
</svg>`;}
function svgCross(size=96){return `
<svg class="token" width="${size}" height="${size}" viewBox="0 0 64 64" aria-hidden="true">
  <circle cx="32" cy="32" r="30" fill="#ef4444"></circle>
  <path d="M22 22l20 20M42 22L22 42" stroke="#fff" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" fill="none"></path>
</svg>`;}

/* ===== Load puzzles (supports multiple JSON shapes) ===== */
async function loadPuzzles(){
  const version = ymd(); // cache-bust per day
  const res = await fetch(`${DATA_URL}?v=${version}`, { cache: "no-store" });
  const data = await res.json();
  const day = normalizeDataToToday(data);
  if(!day || day.length !== 3) throw new Error("Invalid puzzles.json: need 3 puzzles for the day.");
  todaySet = day;
}

/* Accepts:
  A) { days: [ [ {words,odd,explanation} x3 ], ... ] }
  B) [ [ {words,odd,explanation} x3 ], ... ]
  C) { themes: [ {difficulty, items[4], answer, explanation}, ... ] } â†’ pick 1 per difficulty via seeded RNG
*/
function normalizeDataToToday(data){
  const seed = ymd();
  // C) themes style
  if(data && Array.isArray(data.themes)){
    const rng = mulberry32(Number(seed));
    const pick = (d) => {
      const arr = data.themes.filter(t=>String(t.difficulty).toLowerCase()===d);
      const p = seededPick(rng, arr);
      return { items:[...p.items], answer:p.answer, explanation:p.explanation };
    };
    return ["easy","medium","hard"].map(pick);
  }
  // A) named days
  if(data && Array.isArray(data.days)){
    const idx = Number(seed) % data.days.length;
    return data.days[idx].map(p => ({ items:[...p.words], answer:p.odd, explanation:p.explanation }));
  }
  // B) bare array of days
  if(Array.isArray(data) && Array.isArray(data[0])){
    const idx = Number(seed) % data.length;
    return data[idx].map(p => ({ items:[...p.words], answer:p.odd, explanation:p.explanation }));
  }
  return null;
}

/* ===== Game flow ===== */
function updateFooter(){
  footerInfo.innerHTML = `Seed: ${ymd()}<br>Date: ${ymdDash()}<br>ðŸ”¥ Streak: ${streak.current} (Best: ${streak.best})`;
}
function startPuzzle(i){
  currentIndex = i;
  progressEl.textContent = `Puzzle ${i+1}/3`;
  const p = todaySet[i];
  const items = shuffle([...p.items]);

  optEl.innerHTML = "";
  items.forEach((text)=>{
    const tile = document.createElement("div");
    tile.className = "option " + (i===2 ? "lvl3" : ""); // only level 3 glows
    if(i===2){ tile.style.animationDelay = (Math.random()*3).toFixed(2)+'s'; } // independent stagger
    tile.innerHTML = `<span>${text}</span>`;
    tile.onclick = ()=>onChoose(text,p,tile);
    optEl.appendChild(tile);
  });
}
function onChoose(choice,puzzle,tile){
  if(navigator.vibrate) navigator.vibrate(50);
  [...optEl.children].forEach(c=>c.onclick=null);
  const ok = (choice === puzzle.answer);
  results.push(ok ? "âœ”" : "âœ–");
  showOverlay(ok, puzzle.explanation, ()=>{
    if(ok){
      if(currentIndex<2){ startPuzzle(currentIndex+1); }
      else { finish(true); }
    }else{
      finish(false);
    }
  });
}
function showOverlay(ok, explanation, next){
  iconSlot.innerHTML = ok ? svgCheck() : svgCross();
  iconLabel.textContent = ok ? "Correct" : "Game Over";
  iconLabel.style.color = ok ? "#10b981" : "#ef4444";
  iconEx.textContent = explanation;
  continueBtn.style.background = ok ? "#10b981" : "#ef4444";
  overlay.style.display = "flex";
  continueBtn.onclick = () => { overlay.style.display = "none"; next(); };
}
function finish(won){
  optEl.innerHTML = "";
  endScreen.style.display = "flex";
  finalChecks.innerHTML = results.map(r => r==="âœ”" ? svgCheck(56) : svgCross(56)).join("");
  summaryEl.textContent = won ? "Cleared all!" : "Game over";
  shareBtn.style.display = "inline-flex";

  const today = ymd();
  if(streak.lastDate !== today){
    if(won){ streak.current = (streak.current + 1); }
    else { streak.current = 0; }
    streak.best = Math.max(streak.best, streak.current);
    streak.lastDate = today; saveStreak();
  }
  updateFooter();
  if(won){ confetti({particleCount:250,spread:100,origin:{y:.6}}); }
}
shareBtn.onclick = ()=>{
  const d = ymdDash();
  let msg = "";
  if(results[0]==="âœ–"){msg="Altera humbled me today ðŸ’€ (0/3)";}
  else if(results[1]==="âœ–"){msg="I only cracked 1 puzzle on Altera ðŸ«  (1/3)";}
  else if(results[2]==="âœ–"){msg="So close! 2/3 on Altera ðŸ˜¤";}
  else{msg="Flawless! 3/3 on Altera ðŸŽ‰";}
  const text = `Altera ${d}\n${msg}\nðŸ”¥ Streak: ${streak.current}`;
  if(navigator.share){navigator.share({title:"Altera",text});}
  else{navigator.clipboard.writeText(text).then(()=>alert("Results copied!"));}
};

/* ===== Boot ===== */
(async function init(){
  loadStreak();
  updateFooter();
  try{
    await loadPuzzles();
    startPuzzle(0);
  }catch(e){
    // Show a friendly error overlay if puzzles.json is missing/invalid
    iconSlot.innerHTML = svgCross();
    iconLabel.textContent = "Can't load puzzles";
    iconLabel.style.color = "#ef4444";
    iconEx.textContent = "Make sure puzzles.json exists next to index.html and matches one of the supported formats.";
    continueBtn.textContent = "Retry";
    continueBtn.style.background = "#ef4444";
    overlay.style.display = "flex";
    continueBtn.onclick = ()=>location.reload();
  }
})();
</script>
</body>
</html>