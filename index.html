<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Altera — Daily Logic Game</title>
<link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">
<style>
:root{
  --fg:#0e1320;             /* darker text when needed */
  --fg-inv:#ffffff;         /* on color */
  --radius:14px;
  /* Brand / tile colors */
  --c1:#5b6cff; /* indigo */
  --c2:#2ec6ff; /* cyan */
  --c3:#ff477e; /* crimson/pink */
  --c4:#ffb020; /* amber */
  --correct:#10b981;
  --wrong:#ef4444;

  --bg1:#0f1830;  /* brighter background spectrum */
  --bg2:#1d2c5d;
  --bg3:#243b82;
  --bg4:#157ea8;
}

/* Layout: header / main / footer — no scroll */
html,body{height:100%}
body{
  margin:0;
  font-family:'Bungee',sans-serif;
  color:var(--fg-inv);
  background: linear-gradient(120deg, var(--bg1), var(--bg2), var(--bg3), var(--bg2), var(--bg4));
  background-size: 220% 220%;
  animation: bgSoft 22s ease-in-out infinite;
  display:grid;
  grid-template-rows:auto 1fr auto;
  overflow:hidden;
}
@keyframes bgSoft{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

/* Header */
header{ text-align:center; padding:6px 8px 0 }
.logo{
  margin:0;
  font-size:50px;
  /* Soft color cycle (not a sweeping gradient) */
  color:var(--c1);
  animation: logoColor 14s linear infinite, logoPulse 8s ease-in-out infinite;
}
@keyframes logoColor{
  0%{color:var(--c1)}
  25%{color:var(--c2)}
  50%{color:var(--c3)}
  75%{color:var(--c4)}
  100%{color:var(--c1)}
}
@keyframes logoPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}

.sub{
  margin:2px 0 2px;
  font-size:15px;
  font-weight:400;
  opacity:.9;
}
#progress{
  font-size:14px;
  opacity:.85;
  margin:2px 0 6px;
  letter-spacing:.5px;
}

/* Main — perfectly centered between header/footer */
#game{
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:0;
}
#options{
  width:100%;
  max-width:460px;
  padding:0 18px;
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:16px;
}

/* Base tile */
.option{
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  border-radius:var(--radius);
  aspect-ratio:1/1;
  font-size:22px;
  text-align:center;
  user-select:none;
  cursor:pointer;
  overflow:hidden;
  transform:translateZ(0);
  transition:transform .2s ease, box-shadow .2s ease, filter .2s ease;
  will-change:transform;
  padding:10px;
}
.option:active{ transform:scale(.96) }
.option span{display:block}

/* Base colors by grid position for consistent identity */
.option:nth-child(1){ background:var(--c1) }
.option:nth-child(2){ background:var(--c2) }
.option:nth-child(3){ background:var(--c3) }
.option:nth-child(4){ background:var(--c4) }

/* Depth common */
.option{ box-shadow: 0 6px 18px rgba(0,0,0,.25) }

/* ---------- LEVEL SYSTEM (12 styles total) ---------- */
/* L1 (easy): solid, tactile (no pattern) */
.lvl1{ 
  /* subtle inner highlight */
  background-image:
    radial-gradient(120% 140% at 50% -10%, rgba(255,255,255,.18), transparent 45%);
}

/* L2 (medium): “badge” treatments (static, game-like) */
.badge-rim::before,
.badge-cut::before,
.badge-glow::before,
.badge-grid::before{
  content:""; position:absolute; inset:0; border-radius:calc(var(--radius) + 2px); pointer-events:none;
}
.badge-rim::before{ outline:2px solid rgba(255,255,255,.22); outline-offset:-6px }
.badge-cut{ clip-path: polygon(6% 0, 94% 0, 100% 6%, 100% 94%, 94% 100%, 6% 100%, 0 94%, 0 6%) }
.badge-glow::before{ box-shadow: inset 0 0 0 2px rgba(255,255,255,.18), inset 0 0 30px rgba(255,255,255,.15) }
.badge-grid::before{
  background-image:
    linear-gradient(rgba(255,255,255,.1) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,.1) 1px, transparent 1px);
  background-size: 16px 16px;
  border-radius:inherit;
}

/* L3 (hard): animated effects (subtle, each unique) */
.fx-sheen::after,
.fx-orbit::after,
.fx-ripple::after,
.fx-sparkle::after{
  content:""; position:absolute; inset:0; pointer-events:none; border-radius:inherit;
}

/* Sheen sweep */
.fx-sheen::after{
  background:linear-gradient(120deg, transparent 35%, rgba(255,255,255,.28) 50%, transparent 65%);
  transform: translateX(-120%);
  animation: sheen 2.6s ease-in-out infinite;
}
@keyframes sheen{
  0%{ transform:translateX(-120%) }
  45%{ transform:translateX(140%) }
  100%{ transform:translateX(140%) }
}

/* Orbit dots (slow, elegant) */
.fx-orbit::after{
  background-image:
    radial-gradient(rgba(255,255,255,.22) 2px, transparent 3px),
    radial-gradient(rgba(255,255,255,.12) 1.2px, transparent 2px);
  background-size: 12px 12px, 22px 22px;
  animation: orbit 9s linear infinite;
  opacity:.8;
}
@keyframes orbit{
  from{ background-position: 0 0, 0 0 }
  to{   background-position: 80px 0, -60px 0 }
}

/* Ripple (center out) */
.fx-ripple::after{
  background: radial-gradient(circle at 50% 50%, rgba(255,255,255,.24), transparent 40%);
  animation: ripple 2.8s ease-in-out infinite;
  opacity:.45;
}
@keyframes ripple{
  0%{ transform:scale(0.8); opacity:.0 }
  25%{ transform:scale(1.0); opacity:.45 }
  60%{ transform:scale(1.25); opacity:.18 }
  100%{ transform:scale(1.35); opacity:0 }
}

/* Sparkle (light noise twinkle) */
.fx-sparkle::after{
  background-image:
    radial-gradient(rgba(255,255,255,.28) 1.4px, transparent 1.4px),
    radial-gradient(rgba(255,255,255,.14) 1px, transparent 1px);
  background-size: 10px 10px, 18px 18px;
  animation: sparkle 4.5s ease-in-out infinite;
  opacity:.85;
}
@keyframes sparkle{
  0%,100%{ filter:brightness(1) }
  50%{ filter:brightness(1.12) }
}

/* Flip + result */
.option.flip{ animation:flipTile .6s forwards }
.option.correct{ background:var(--correct)!important }
.option.wrong{ background:var(--wrong)!important }
@keyframes flipTile{0%{transform:rotateY(0)}50%{transform:rotateY(90deg)}100%{transform:rotateY(0)}}

/* Overlay */
#feedbackOverlay{
  position:fixed; inset:0; display:none;
  align-items:center; justify-content:center; flex-direction:column;
  background:rgba(0,0,0,.92); z-index:100; text-align:center; padding:20px;
}
#feedbackOverlay.correct .symbol{ color:var(--correct) }
#feedbackOverlay.wrong .symbol{ color:var(--wrong) }
#feedbackOverlay .symbol{ font-size:100px; font-weight:900; margin-bottom:18px }
#feedbackOverlay .text{ font-size:36px; font-weight:800; margin-bottom:14px }
#feedbackOverlay .explanation{ font-size:18px; max-width:360px; margin-bottom:20px }
#feedbackOverlay button{
  padding:16px 28px; border:none; border-radius:var(--radius);
  background:var(--c1); color:#fff; font-size:20px; cursor:pointer;
  transition:transform .2s ease;
}
#feedbackOverlay button:hover{ transform:scale(1.05) }

/* End screen — CENTER the share button */
#endScreen{
  width:100%;
  max-width:460px;
  display:flex;
  flex-direction:column;
  align-items:center;        /* center contents */
  justify-content:center;
  gap:12px;
  margin-top:12px;
  text-align:center;
}
#summary{ font-size:18px }
button.primary{
  background:var(--c1); color:#fff; font-weight:600;
  padding:20px 36px; font-size:22px; border-radius:var(--radius);
  margin: 0 auto; display:block; /* ensure true centering */
  box-shadow: 0 10px 24px rgba(0,0,0,.25);
}
.hidden{display:none}

/* Footer (stacked, compact) */
footer{
  text-align:center;
  font-size:12px;
  opacity:.95;
  padding:6px 8px 10px;
  line-height:1.35em;
}
</style>
</head>
<body>
  <header>
    <h1 class="logo" id="logo">ALTERA</h1>
    <div class="sub">Find the odd one out</div>
    <div id="progress"></div>
  </header>

  <main id="game">
    <div id="options"></div>

    <div id="endScreen" class="hidden">
      <div id="summary"></div>
      <button class="primary hidden" id="shareBtn">Share</button>
    </div>
  </main>

  <div id="feedbackOverlay">
    <div class="symbol"></div>
    <div class="text"></div>
    <div class="explanation"></div>
    <button id="continueBtn">Continue</button>
  </div>

  <footer id="footerInfo"></footer>

<script>
/* --------- Config --------- */
const DATA_URL="puzzles.json";
const DIFFICULTIES=["easy","medium","hard"];
const tz="America/Edmonton";

/* --------- State --------- */
let puzzles=[], todaySet=[], currentIndex=0, results=[];
let pendingCallback=null;
let streakData={ current:0, best:0, lastDate:null };

/* --------- Helpers --------- */
function loadStreak(){ const s=localStorage.getItem("altera_streak"); if(s){streakData=JSON.parse(s);} }
function saveStreak(){ localStorage.setItem("altera_streak", JSON.stringify(streakData)); }
function toYMD(date,tz){ const z=new Date(date.toLocaleString('en-US',{timeZone:tz})); return `${z.getFullYear()}${String(z.getMonth()+1).padStart(2,'0')}${String(z.getDate()).padStart(2,'0')}`; }
function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15,t|1); t^=t+Math.imul(t^t>>>7,t|61); return((t^t>>>14)>>>0)/4294967296; } }
function seededPick(rng,arr){ return arr[Math.floor(rng()*arr.length)] }
function shuffleArray(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

/* --------- DOM --------- */
const optEl=document.getElementById("options");
const endScreen=document.getElementById("endScreen");
const summaryEl=document.getElementById("summary");
const shareBtn=document.getElementById("shareBtn");
const overlay=document.getElementById("feedbackOverlay");
const overlaySymbol=overlay.querySelector(".symbol");
const overlayText=overlay.querySelector(".text");
const overlayExp=overlay.querySelector(".explanation");
const continueBtn=document.getElementById("continueBtn");
const footerInfo=document.getElementById("footerInfo");
const progressEl=document.getElementById("progress");

/* --------- Level styles (12 total) --------- */
const level2Classes=["badge-rim","badge-cut","badge-glow","badge-grid"]; // static, game-y
const level3Classes=["fx-sheen","fx-orbit","fx-ripple","fx-sparkle"];     // animated, subtle

/* --------- Init --------- */
loadStreak();
loadData();

async function loadData(){
  const res=await fetch(DATA_URL);
  const data=await res.json();
  puzzles=data.themes;
  setupDaily();
}

function setupDaily(){
  const seed=toYMD(new Date(),tz);
  const rng=mulberry32(Number(seed));
  todaySet=DIFFICULTIES.map(d=>seededPick(rng, puzzles.filter(p=>p.difficulty===d)));
  updateFooter(seed);
  startPuzzle(0);
}

function updateFooter(seed){
  const today=new Date().toLocaleDateString('en-CA',{timeZone:tz});
  footerInfo.innerHTML=`Seed: ${seed}<br>Date: ${today}<br>🔥 Streak: ${streakData.current} (Best: ${streakData.best})`;
}

function startPuzzle(i){
  currentIndex=i;
  progressEl.textContent=`Puzzle ${i+1}/3`;

  const p=todaySet[i];
  const shuffled=shuffleArray([...p.items]);

  optEl.innerHTML="";
  shuffled.forEach((item,idx)=>{
    const tile=document.createElement("div");
    tile.className="option lvl"+(i+1); // lvl1|lvl2|lvl3

    // Assign style variants for level 2 & 3
    if(i===1){ tile.classList.add(level2Classes[idx]); }
    if(i===2){ tile.classList.add(level3Classes[idx]); }

    tile.innerHTML=`<span>${item}</span>`;
    tile.onclick=()=>choose(tile,item,p);
    optEl.appendChild(tile);
  });
}

function choose(tile, choice, puzzle){
  if(navigator.vibrate) navigator.vibrate(50);
  Array.from(optEl.children).forEach(c=>c.onclick=null);
  const correct=(choice===puzzle.answer);
  tile.classList.add("flip");
  setTimeout(()=>{ tile.classList.add(correct?"correct":"wrong"); },300);

  if(correct){
    results.push("✅");
    showOverlay(true, puzzle.explanation, ()=>{
      if(currentIndex<2){ startPuzzle(currentIndex+1); }
      else{ finishGame(true); }
    });
  }else{
    results.push("❌");
    showOverlay(false, puzzle.explanation, ()=>finishGame(false));
  }
}

function showOverlay(correct, explanation, cb){
  overlay.style.display="flex";
  overlay.className=correct?"correct":"wrong";
  overlaySymbol.textContent=correct?"✓":"✕";
  overlayText.textContent=correct?"Correct":"Game Over";
  overlayExp.textContent=explanation;
  pendingCallback=cb;
}

continueBtn.onclick=()=>{
  overlay.style.display="none";
  if(pendingCallback){ pendingCallback(); pendingCallback=null; }
};

function finishGame(won){
  // Update streak immediately, then update UI before showing share
  const todaySeed=toYMD(new Date(),tz);
  if(streakData.lastDate!==todaySeed){
    if(won){
      const yesterday=toYMD(new Date(Date.now()-86400000),tz);
      streakData.current = (streakData.lastDate===yesterday) ? (streakData.current+1) : 1;
      streakData.best=Math.max(streakData.best, streakData.current);
    }else{
      streakData.current=0;
    }
    streakData.lastDate=todaySeed;
    saveStreak();
  }
  updateFooter(todaySeed); // <-- refresh UI immediately

  // End screen
  optEl.innerHTML="";
  endScreen.classList.remove("hidden");
  summaryEl.textContent=`${results.join(" ")} (${won?"Cleared all!":"Game over"})`;
  shareBtn.classList.remove("hidden");
}

shareBtn.onclick=()=>{
  const d=new Date().toLocaleDateString('en-CA',{timeZone:tz});
  const text=`Altera ${d}\n${results.join(" ")}\n🔥 Streak: ${streakData.current}\nPlay: (your game URL)`;
  if(navigator.share){ navigator.share({title:"Altera",text}); }
  else{ navigator.clipboard.writeText(text).then(()=>alert("Results copied!")); }
};
</script>
</body>
</html>