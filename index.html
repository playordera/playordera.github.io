<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width,initial-scale=1.0,maximum-scale=1.0,viewport-fit=cover,user-scalable=no" />
  <title>Altera</title>
  <link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet" />

  <style>
  :root {
    --correct:#10b981;
    --wrong:#ef4444;
    --tile1:#5b6cff; --tile2:#2ec6ff; --tile3:#ff477e; --tile4:#ffb020;
    --logo1:#2ec6ff; --logo2:#ffb020;
  }

  * { box-sizing:border-box; margin:0; padding:0; }

  body {
    font-family:'Bungee',sans-serif;
    color:#fff;
    background:#142049;
    display:flex;
    flex-direction:column;
    height:100vh; /* full viewport */
    text-align:center;
  }

  /* Header */
  header {
    padding:8px 0 4px;
    flex-shrink:0;
  }
  .logo {
    font-size:38px; font-weight:900;
    background:linear-gradient(90deg,var(--logo1),var(--logo2));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    text-shadow:0 0 6px rgba(0,0,0,0.4);
  }
  .sub { font-size:14px; margin:2px 0; opacity:0.95; }
  #progress { font-size:12px; margin:2px 0 4px; }

  /* Main */
  main {
    flex:1;
    display:flex; justify-content:center; align-items:center;
    padding:0 10px;
  }
  #options {
    width:100%; max-width:400px;
    display:grid; grid-template-columns:repeat(2,1fr);
    gap:8px;
  }
  .option {
    display:flex; align-items:center; justify-content:center;
    aspect-ratio:1/1; border-radius:10px;
    font-size:16px; cursor:pointer; user-select:none;
    color:#fff; font-weight:bold; transition:.2s transform;
  }
  .option:active { transform:scale(.95); }
  .option:nth-child(1){background:var(--tile1);}
  .option:nth-child(2){background:var(--tile2);}
  .option:nth-child(3){background:var(--tile3);}
  .option:nth-child(4){background:var(--tile4);}
  .correct { background:var(--correct)!important; }
  .wrong { background:var(--wrong)!important; }

  /* Overlay & End screen */
  #overlay, #endScreen {
    position:fixed; inset:0; display:none;
    flex-direction:column; align-items:center; justify-content:center;
    background:rgba(0,0,0,.9); z-index:50; padding:20px;
  }
  #overlay.show, #endScreen.show { display:flex; }
  #overlay h1 { margin:0 0 6px; font-size:26px; }
  #overlay p { font-size:14px; max-width:300px; }

  #continueBtn {
    margin-top:10px; padding:10px 20px;
    border:none; border-radius:8px; background:var(--correct);
    color:#fff; font-size:14px; cursor:pointer;
  }

  #endIcons { font-size:44px; margin-bottom:8px; }
  #endText { margin:0; font-size:22px; }
  #shareBtn {
    display:none; margin-top:12px;
    padding:10px 20px; font-size:16px;
    border:none; border-radius:8px; background:#5b6cff;
    color:#fff; cursor:pointer;
  }

  /* Footer pinned */
  footer {
    font-size:11px; padding:4px 0; opacity:.85; line-height:1.2;
    flex-shrink:0;
    background:#0e1633;
  }

  /* Responsive scaling for small screens */
  @media (max-height:700px) {
    .logo { font-size:32px; }
    .sub { font-size:12px; }
    #options { max-width:340px; gap:6px; }
    .option { font-size:14px; }
  }
  @media (max-height:600px) {
    .logo { font-size:28px; }
    #options { max-width:300px; gap:5px; }
    .option { font-size:12px; }
  }
  </style>
</head>
<body>
  <header>
    <div class="logo">ALTERA</div>
    <div class="sub">FIND THE ODD ONE OUT</div>
    <div id="progress"></div>
  </header>

  <main>
    <div id="options"></div>
  </main>

  <!-- Feedback -->
  <div id="overlay">
    <h1 id="result"></h1>
    <p id="explanation"></p>
    <button id="continueBtn">Continue</button>
  </div>

  <!-- End screen -->
  <div id="endScreen">
    <div id="endIcons"></div>
    <h1 id="endText"></h1>
    <button id="shareBtn">Share</button>
  </div>

  <footer id="footerInfo"></footer>

  <script>
  const DATA_URL="puzzles.json";
  let puzzles, todaySet;
  let level=0;
  let results=[];

  const options=document.getElementById("options"),
        progressEl=document.getElementById("progress"),
        overlay=document.getElementById("overlay"),
        resultEl=document.getElementById("result"),
        explanationEl=document.getElementById("explanation"),
        continueBtn=document.getElementById("continueBtn"),
        endScreen=document.getElementById("endScreen"),
        endIcons=document.getElementById("endIcons"),
        endText=document.getElementById("endText"),
        shareBtn=document.getElementById("shareBtn"),
        footerInfo=document.getElementById("footerInfo");

  function ymd(){const d=new Date();return d.getFullYear()+String(d.getMonth()+1).padStart(2,"0")+String(d.getDate()).padStart(2,"0");}
  function ymdDash(){const d=new Date();return d.toISOString().split("T")[0];}
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

  async function loadPuzzles(){
    const res=await fetch(DATA_URL+"?v="+ymd(),{cache:"no-store"});
    const data=await res.json();
    puzzles=data.days;
    const idx=parseInt(ymd())%puzzles.length;
    todaySet=puzzles[idx];
  }

  function renderLevel(){
    progressEl.textContent=`Puzzle ${level+1}/3`;
    options.innerHTML="";
    const pool= level===0 ? todaySet.easy : (level===1?todaySet.medium:todaySet.hard);
    const items=shuffle([...pool.words]);
    items.forEach((w)=>{
      const t=document.createElement("div");
      t.className="option";
      t.textContent=w;
      t.onclick=()=>checkChoice(w,pool,t);
      options.appendChild(t);
    });
  }

  function checkChoice(choice,pool,tile){
    [...options.children].forEach(c=>c.onclick=null);
    if(choice===pool.odd){
      tile.classList.add("correct");
      results.push("✓");
      showFeedback(true,pool.explanation);
    }else{
      tile.classList.add("wrong");
      results.push("✗");
      showFeedback(false,pool.explanation);
    }
  }

  function showFeedback(ok,ex){
    resultEl.textContent=ok?"✓ Correct":"✗ Wrong";
    resultEl.style.color=ok?"var(--correct)":"var(--wrong)";
    explanationEl.textContent=ex;
    continueBtn.style.background=ok?"var(--correct)":"var(--wrong)";
    overlay.classList.add("show");
  }

  continueBtn.onclick=()=>{
    overlay.classList.remove("show");
    if(results[results.length-1]==="✗"){finish(false);}
    else if(++level<3){renderLevel();}
    else{finish(true);}
  };

  function finish(win){
    options.innerHTML="";
    endScreen.classList.add("show");
    endIcons.innerHTML=results.map(r=> r==="✓"
      ? `<span style="color:var(--correct)">✓</span>`
      : `<span style="color:var(--wrong)">✗</span>`).join(" ");
    endText.textContent=win?"You Win!":"Game Over";
    updateFooter();
    shareBtn.style.display="inline-block";
  }

  shareBtn.onclick=()=>{
    let score = results.filter(r=>r==="✓").length;
    let seed = ymd();
    let date = ymdDash();
    let msg = `Altera — Seed ${seed} (${date})\nScore: ${score}/3\n`;

    if(score===0){
      msg += "Pathetic. How did you even manage zero?";
    } else if(score===1){
      msg += "1/3… embarrassing. Were you even trying?";
    } else if(score===2){
      msg += "So close! Not bad, but still not perfect.";
    } else if(score===3){
      msg += "Flawless victory! You're a genius.";
    }

    if(navigator.share){navigator.share({title:"Altera",text:msg});}
    else{navigator.clipboard.writeText(msg).then(()=>alert("Copied!"));}
  };

  function updateFooter(){
    footerInfo.innerHTML=`Seed: ${ymd()}<br>Date: ${ymdDash()}`;
  }

  (async function(){
    updateFooter();
    await loadPuzzles(); renderLevel();
  })();
  </script>
</body>
</html>