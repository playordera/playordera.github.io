<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Altera — Daily Logic Game</title>
<link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">

<style>
:root {
  --bg1: #1e1e2f;
  --bg2: #2a2a40;
  --bg3: #3b3b52;
  --fg: #fff;
  --accent1: #3b82f6;
  --accent2: #ef4444;
  --accent3: #10b981;
  --accent4: #f59e0b;
  --radius: 12px;
}

body {
  margin:0; padding:0;
  font-family:'Bungee', sans-serif;
  background: linear-gradient(-45deg, var(--bg1), var(--bg2), var(--bg3), var(--bg2));
  background-size: 400% 400%;
  animation: gradientShift 20s ease infinite;
  color:var(--fg);
  display:flex; flex-direction:column;
  min-height:100vh;
  overflow-x:hidden;
}

@keyframes gradientShift {
  0% {background-position:0% 50%;}
  50% {background-position:100% 50%;}
  100% {background-position:0% 50%;}
}

/* Header */
header {
  text-align:center;
  padding:20px 10px 5px;
  animation: headerPulse 6s infinite ease-in-out;
}
@keyframes headerPulse {
  0%,100% {opacity:1;}
  50% {opacity:0.85;}
}
header h1 {
  font-size:40px; margin:0;
  letter-spacing:2px;
}
header h2 {
  font-size:16px; margin:5px 0 10px;
  font-weight:400; opacity:0.85;
}

/* Game area */
#game {
  flex:1; display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  padding:0 20px;
}

#options {
  display:grid; grid-template-columns:repeat(2,1fr);
  gap:16px; width:100%;
  max-width:420px;
}

.option {
  display:flex; align-items:center; justify-content:center;
  border-radius:var(--radius);
  font-size:24px; line-height:1.2; text-align:center;
  cursor:pointer; user-select:none;
  aspect-ratio:1/1;
  color:#fff; padding:10px;
  transition:transform 0.2s ease;
  perspective:1000px;
}
.option span { display:block; }

/* Colors */
.option:nth-child(1){ background:var(--accent1);}
.option:nth-child(2){ background:var(--accent2);}
.option:nth-child(3){ background:var(--accent3);}
.option:nth-child(4){ background:var(--accent4);}

/* Animations */
.option:active { transform:scale(0.93) rotate(-1deg); }

/* Flip animations */
.option.flip {
  animation: flipTile 0.6s forwards;
}
.option.correct { background:#10b981 !important; }
.option.wrong { background:#ef4444 !important; }

@keyframes flipTile {
  0% {transform:rotateY(0);}
  50% {transform:rotateY(90deg);}
  100% {transform:rotateY(0);}
}

/* End screen */
#endScreen { text-align:center; margin-top:20px; }
button {
  padding:12px 20px; font-size:16px; border-radius:var(--radius);
  border:none; cursor:pointer; margin-top:14px;
  font-family:'Bungee', sans-serif;
  transition:transform 0.2s ease;
}
button.primary { background:var(--accent1); color:white; font-weight:600; }
button:hover { transform:scale(1.05); }
.hidden { display:none; }

/* Overlay */
#feedbackOverlay {
  position:fixed; inset:0; display:none;
  align-items:center; justify-content:center; flex-direction:column;
  background:rgba(0,0,0,0.92);
  z-index:100; text-align:center; padding:20px;
  animation: fadeIn 0.3s ease;
}
#feedbackOverlay.correct .symbol { color:#10b981; }
#feedbackOverlay.wrong .symbol { color:#ef4444; }
#feedbackOverlay .symbol {
  font-size:100px; font-weight:900; margin-bottom:18px;
  animation: popIn 0.4s ease;
}
#feedbackOverlay .text {
  font-size:36px; font-weight:800; margin-bottom:14px;
  animation: popIn 0.4s ease;
}
#feedbackOverlay .explanation {
  font-size:18px; color:var(--fg); max-width:360px;
  animation: fadeIn 0.5s ease;
}
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
@keyframes popIn { 0%{transform:scale(0.6);opacity:0;} 100%{transform:scale(1);opacity:1;} }

/* Footer */
footer {
  text-align:center; font-size:14px;
  opacity:0.8; padding:10px;
}
</style>
</head>

<body>
<header>
  <h1>ALTERA</h1>
  <h2>Find the odd one out</h2>
</header>

<div id="game">
  <div id="options"></div>
  <div id="endScreen" class="hidden">
    <div id="summary"></div>
    <button class="primary hidden" id="shareBtn">Share</button>
  </div>
</div>

<div id="feedbackOverlay">
  <div class="symbol"></div>
  <div class="text"></div>
  <div class="explanation"></div>
</div>

<footer id="footerInfo"></footer>

<script>
const DATA_URL = "puzzles.json"; 
const DIFFICULTIES = ["easy","medium","hard"];
const tz = "America/Edmonton";

let puzzles=[], todaySet=[], currentIndex=0, results=[], usedSeeds=[];

function toYMD(date, tz){
  const z = new Date(date.toLocaleString('en-US',{timeZone:tz}));
  return `${z.getFullYear()}${String(z.getMonth()+1).padStart(2,'0')}${String(z.getDate()).padStart(2,'0')}`;
}
function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15,t|1); t^=t+Math.imul(t^t>>>7,t|61); return((t^t>>>14)>>>0)/4294967296; } }
function seededPick(rng, arr){ return arr[Math.floor(rng()*arr.length)]; }

function shuffleArray(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

const optEl=document.getElementById("options");
const endScreen=document.getElementById("endScreen");
const summaryEl=document.getElementById("summary");
const shareBtn=document.getElementById("shareBtn");
const overlay=document.getElementById("feedbackOverlay");
const overlaySymbol=overlay.querySelector(".symbol");
const overlayText=overlay.querySelector(".text");
const overlayExp=overlay.querySelector(".explanation");
const footerInfo=document.getElementById("footerInfo");

async function loadData(){
  const res=await fetch(DATA_URL);
  const data=await res.json();
  puzzles=data.themes;
  setupDaily();
}

function setupDaily(){
  const seed=toYMD(new Date(),tz);
  if(usedSeeds.includes(seed)) return; 
  usedSeeds.push(seed);
  const rng=mulberry32(Number(seed));
  todaySet=DIFFICULTIES.map(diff=>{
    const pool=puzzles.filter(p=>p.difficulty===diff);
    return seededPick(rng,pool);
  });
  footerInfo.textContent=`Seed: ${seed} | ${new Date().toLocaleDateString('en-CA',{timeZone:tz})}`;
  startPuzzle(0);
}

function startPuzzle(i){
  currentIndex=i;
  const p=todaySet[i];
  let shuffled = shuffleArray([...p.items]); 
  optEl.innerHTML="";
  shuffled.forEach(item=>{
    const div=document.createElement("div");
    div.className="option";
    div.innerHTML=`<span>${item}</span>`;
    div.onclick=()=>choose(div,item,p);
    optEl.appendChild(div);
  });
}

function showOverlay(correct, explanation, callback){
  overlay.style.display="flex";
  overlaySymbol.textContent=correct?"✓":"✕";
  overlayText.textContent=correct?"Correct":"Game Over";
  overlay.className=correct?"correct":"wrong";
  overlayExp.textContent=explanation;
  setTimeout(()=>{
    overlay.style.display="none";
    callback();
  },1800);
}

function choose(tile, choice,puzzle){
  Array.from(optEl.children).forEach(c=>c.onclick=null);
  const correct=(choice===puzzle.answer);
  tile.classList.add("flip");
  setTimeout(()=>{
    tile.classList.add(correct?"correct":"wrong");
  },300);
  if(correct){
    results.push("✅");
    showOverlay(true,puzzle.explanation,()=>{
      if(currentIndex<2){ startPuzzle(currentIndex+1); }
      else{ finishGame(true); }
    });
  }else{
    results.push("❌");
    showOverlay(false,puzzle.explanation,()=>finishGame(false));
  }
}

function finishGame(won){
  optEl.innerHTML="";
  endScreen.classList.remove("hidden");
  summaryEl.textContent=`${results.join(" ")} (${won?"Cleared all!":"Game over"})`;
  shareBtn.classList.remove("hidden");
}

shareBtn.onclick=()=>{
  const d=new Date().toLocaleDateString('en-CA',{timeZone:tz});
  const text=`Altera ${d}\n${results.join(" ")}\nPlay: (your game URL)`;
  if(navigator.share){navigator.share({title:"Altera",text});}
  else{navigator.clipboard.writeText(text).then(()=>alert("Results copied!"));}
};
loadData();
</script>
</body>
</html>